- name: Ansible Playbook to Install and Setup Apache on Ubuntu
  hosts: stagingsrvgrp
  become: yes
  tasks:

    - name: Creat directory phpmyadmin
      file:
        path: /var/www/html/phpmyadmin
        state: directory

    - name: Download PhpMyadmin from website
      get_url:
        url:  https://files.phpmyadmin.net/phpMyAdmin/5.2.1/phpMyAdmin-5.2.1-all-languages.zip
        dest: /var/www/html/phpmyadmin/phpMyAdmin-5.2.1-all-languages.zip
        mode: '0440'
   
    - name: Install Unzip, Tar
      apt:
        name:
          - unzip
          - tar
        state: present
        
    - name: Set permissions folder phpmyadmin
      command:  chmod -R 755 /var/www/html/phpmyadmin/

    - name: extract archive
      unarchive:
        src: /var/www/html/phpmyadmin/phpMyAdmin-5.2.1-all-languages.zip
        dest: /var/www/html/phpmyadmin
        remote_src: true
        validate_certs: true
        extra_opts: "--mode=0755"

    - name: Change file ownership, group and permissions
      ansible.builtin.file:
        path: /var/www/html/phpmyadmin/
        owner: root
        group: root
        mode: '0755'

    - name: Move file
      file:
        src: /var/www/html/phpmyadmin/phpMyAdmin-5.2.1-all-languages/*
        dest: /var/www/html/phpmyadmin/
        state: link

    - name: Rename File 
      file:
        src: /var/www/html/phpmyadmin/config.sample.inc.php
        dest: /var/www/html/phpmyadmin/config.inc.php
        state: link